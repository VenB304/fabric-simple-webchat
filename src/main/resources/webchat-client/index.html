<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple WebChat</title>
    <link rel="stylesheet" href="style.css">
    <script src="app.js" defer></script>
</head>

<body>

    <!-- Login Screen -->
    <div id="login-screen">
        <button id="login-theme-toggle" onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
        <div id="login-box">
            <div id="login-title">Simple WebChat</div>

            <div id="auth-loading" style="color: var(--text-sec);">Connecting...</div>
            <div id="reconnect-msg" style="color: #ff5252; display:none; margin-bottom:10px; font-size:14px;">
                Reconnecting...</div>

            <!-- NONE Mode -->
            <div id="login-none" style="display:none;">
                <div class="input-group">
                    <input type="text" id="none-username" placeholder="Desired Username" maxlength="16">
                </div>
                <button class="btn-primary" onclick="loginNone()">Join Chat</button>
            </div>

            <!-- SIMPLE Mode -->
            <div id="login-simple" style="display:none;">
                <div class="input-group">
                    <input type="text" id="simple-username" placeholder="Username" maxlength="16">
                </div>
                <div class="input-group">
                    <input type="password" id="simple-password" placeholder="Server Password">
                </div>
                <button class="btn-primary" onclick="loginSimple()">Login</button>
            </div>

            <!-- LINKED Mode -->
            <div id="login-linked" style="display:none;">

                <!-- Initial State: Get Code -->
                <div id="linked-step-1">
                    <div style="margin-bottom: 10px; font-size: 14px; color: var(--text-sec);">
                        Enter your Minecraft username and click "Get Code" to receive a login code in-game.
                    </div>
                    <div class="input-group">
                        <input type="text" id="linked-username" placeholder="Minecraft Username" maxlength="16">
                    </div>
                    <button class="btn-primary btn-warning" onclick="requestOtp()">Get Code</button>

                    <div id="resume-session-container"
                        style="display:none; margin-top: 15px; border-top: 1px solid var(--border); padding-top: 15px;">
                        <div style="margin-bottom:10px; color:var(--text-sec);">Session found for: <b
                                id="resume-username" style="color:var(--text-main);"></b></div>
                        <button class="btn-primary btn-success" onclick="resumeSession()">Enter Chat</button>
                        <button class="btn-primary btn-secondary" onclick="logoutLinked()">Sign Out</button>
                    </div>
                </div>

                <!-- Step 2: Verify Code -->
                <div id="linked-step-2" style="display:none;">
                    <div style="margin-bottom: 10px; font-size: 14px; color: var(--text-sec);">
                        Code sent! Check your in-game chat.
                    </div>
                    <div class="input-group">
                        <input type="text" id="linked-code" placeholder="123456" maxlength="6">
                    </div>
                    <button class="btn-primary btn-success" onclick="verifyOtp()">Verify & Login</button>
                    <button class="btn-primary btn-secondary" onclick="resetLinkedUi()">Back</button>
                </div>

            </div>

            <div id="error-msg" class="error-msg"></div>
        </div>
    </div>

    <!-- Main UI -->
    <div id="header-bar">
        <div id="header-title">Web Chat</div>
        <div style="display:flex; align-items:center;">
            <button id="theme-btn" class="icon-btn" onclick="toggleTheme()">üåô/‚òÄÔ∏è</button>
            <button id="logout-btn" onclick="logout()">Logout</button>
            <button id="menu-btn" class="icon-btn" onclick="toggleSidebar()" style="margin-left:10px;">‚ò∞</button>
        </div>
    </div>

    <div id="main-ui">
        <div id="overlay" onclick="toggleSidebar()"></div>
        <div id="chat-area">
            <div id="chat-container"></div>
            <div id="input-area">
                <input type="text" id="message" placeholder="Type a message..." maxlength="256">
                <button id="send-btn" class="btn-primary btn-success" style="width:auto; padding: 12px 20px;"
                    onclick="sendMessage()">Send</button>
            </div>
        </div>
        <div id="sidebar">
            <div
                style="padding-bottom:10px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                <span style="font-weight:bold; font-size:12px; color:var(--text-sec);">LOGGED IN AS</span>
                <span id="current-user-display" style="font-weight:bold; color:var(--text-main);"></span>
            </div>
            <div class="sidebar-header">Online Players</div>
            <div id="player-list"></div>
            <div class="sidebar-header">Web Users</div>
            <div id="web-user-list"></div>

            <div class="sidebar-header"
                style="border-top: 1px solid var(--border); margin-top: 15px; padding-top: 10px;">Settings</div>
            <div style="padding: 5px 0;">
                <label style="font-size: 14px; display: block; margin-bottom: 5px; color: var(--text-sec);">Notification
                    Sound</label>
                <select id="sound-select" onchange="updateSoundSetting()"
                    style="width: 100%; padding: 5px; background: var(--bg-input); color: var(--text-main); border: 1px solid var(--border); border-radius: 4px;">
                    <option value="none">Silent</option>
                    <option value="default">Ding</option>
                </select>
            </div>
        </div>
    </div>
</body>

</html>